<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
   Author Name: Ryan "Bob" Dean
   Assignment : Front page for Bob's Bobs Inc.
   Due Date   : 07/17/2011
   Preferred Browser: Mozilla Firefox
-->

<head>
  <title>Tic Tac Two, The Long Awaited Sequel!</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="game.css" rel="stylesheet" type="text/css" />
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
  <script>
      
      
      var player1 = prompt("What's your username?");
      var player2 = null;
      
      // Player socket.id's
      var p1_id;
      var p2_id;
      
      var myTurn = true;
      var gameStarted = false;
      var x = "x.jpg"
      var o = "o.jpg"
      var blank = "blank.jpg"
      var winner = 0; // 0 - none, 1 - player 1, 2 - player 2
      var board = [0,0,0,0,0,0,0,0,0];
      
      var field;
      
      var win_P1 = 0;
      var win_P2 = 0;
      
      var P1_moves = new Array();
      var P2_moves = new Array();
      
      var startPlayer = 2;
      var curPlayer = 1;
      
      
      function help() {
          alert("Welcome to Tic-Tac-Two!  No help yet")
      }
 
  
     function checkWin() {
         if ((board[0] == 1 && board[1] == 1 && board[2] == 1) || (board[0] == 1 && board[3] == 1 && board[6] == 1) || (board[6] == 1 && board[7] == 1 && board[8] == 1) || (board[2] == 1 && board[5] == 1 && board[8] == 1) || (board[0] == 1 && board[4] == 1 && board[8] == 1) || (board[2] == 1 && board[4] == 1 && board[6] == 1) || (board[1] == 1 && board[4] == 1 && board[7] == 1) || (board[3] == 1 && board[4] == 1 && board[5] == 1)) {
             winner = 1;
             win_P1++;
             document.game.P1.value = win_P1;
             alert("Player one won");
         } else if ((board[0] == 2 && board[1] == 2 && board[2] == 2) || (board[0] == 2 && board[3] == 2 && board[6] == 2) || (board[6] == 2 && board[7] == 2 && board[8] == 2) || (board[2] == 2 && board[5] == 2 && board[8] == 2) || (board[0] == 2 && board[4] == 2 && board[8] == 2) || (board[2] == 2 && board[4] == 2 && board[6] == 2) || (board[1] == 2 && board[4] == 2 && board[7] == 2) || (board[3] == 2 && board[4] == 2 && board[5] == 2)) {
             winner = 2;
             win_P2++;
             document.game.P2.value = win_P2;
             alert("Player two won");
         }
     }
  
     function  play(field) {
         var c = field.charCodeAt(0) - 65;
         if (winner == 0 && board[c] == 0 && myTurn && gameStarted) {
                 board[c] = 1;
                 P1_moves.push(c);
                 if(P1_moves.length > 3) {
                     var remove = P1_moves.shift();
                     board[remove] = 0;
                     document.images[String.fromCharCode(remove + 65)].src = blank;
                 }
                 document.images[field].src = x;
                 curPlayer++;
             myTurn = !myTurn;    
             socket.emit('sendMove', p2_id, board);
             checkWin();
         }
         
     }
  
  function updateBoard() {
      for(var i = 0; i < 9; i++) {
          if(board[i] == 1)
            document.images[String.fromCharCode(i + 65)].src = x;
        else if (board[i] == 2)
            document.images[String.fromCharCode(i + 65)].src = o;
        else
            document.images[String.fromCharCode(i + 65)].src = blank;
      }
  }
  
  function playAgain() {
      curPlayer = startPlayer;
      if(startPlayer == 1)
      startPlayer = 2;
      else
      startPlayer = 1;
      
      P1_moves = new Array();
      P2_moves = new Array();
      winner = 0;
      board = [0,0,0,0,0,0,0,0,0];
      document.images.A.src= blank;
      document.images.B.src= blank;
      document.images.C.src= blank;
      document.images.D.src= blank;
      document.images.E.src= blank;
      document.images.F.src= blank;
      document.images.G.src= blank;
      document.images.H.src= blank;
      document.images.I.src= blank;
  }
  
   function askPlayer() {
      $.prompt("Are You Sure, You Want To Delete ?", { buttons: { Yes: true, No: false }, focus: 0, prefix: 'ValidationMsg', callback: checkPlay });
      //socket.emit('playAgain');
   }
   function checkPlay() {
      
      
   }
      // 10.6.53.133
      //var socket = io.connect('http://10.6.53.133:8080');
      var socket = io.connect('http://localhost:8080');
    
      socket.on('connect', function(){
         
         // Get username, doesn't work
         socket.emit('getusername');
         
         // Init game
         socket.emit('initGame', player1);
         
         //while(p2_id == null) 
         //socket.emit('requestPlayer2ID', player1);
      });
                          
      socket.on('myusername', function (usr) {
         username = usr
      });
              
      socket.on('startGame', function(p2, p2id) {
         player2 = p2;
         p2_id = p2id;
         gameStarted = true;
         document.getElementById('player1').innerHTML=player1;
         document.getElementById('player2').innerHTML=player2; 
      });        
              
      socket.on('recievePlayer2ID', function(p2){
         p2_id = p2;
      });
              
      socket.on ('recieveMove', function(b) {
         board = b;
         myTurn = !myTurn;
         updateBoard();
         checkWin();
      });
              
              
                        
    </script>

</head>

<!-- This section contains the "content" or "structure" of the page. -->
<body>
	<div id="header">
		<a href="index.html"><img alt="The logo for Tic Tac Two." src="logo2.png" /></a>
		<div id="titlebox"><h2>Hope you brought a friend: It's Hotseat Multiplayer!'</h2></div>
		
	</div>
	<div class="clear"></div>
	<div id="wrapper">
		<div id="navigation">
            <a href="login.html">Login</a>
			<a href="tictactwo.html">Hot Seat Multiplayer</a>
			<a href="hostgame.html">Host Online Game</a>
            <a href="records.html">Check Records</a>
			<a href="aboutus.html">About Us</a>
		
		</div>
	</div>
	<div id="maincontent">

        
        <center>
            <form name=game>
                <table border=0>
                    <td>
                        <table border=1>
                            <tr>
                                <td><a href="javascript:play('A')"><img src="blank.jpg" border=0 height=100 width=100 name=A alt="Top-Left"></a></td>
                                <td><a href="javascript:play('B')"><img src="blank.jpg" border=0 height=100 width=100 name=B alt="Top-Center"></a></td>
                                <td><a href="javascript:play('C')"><img src="blank.jpg" border=0 height=100 width=100 name=C alt="Top-Right"></a></td>
                            </tr>
                            <tr>
                                <td><a href="javascript:play('D')"><img src="blank.jpg" border=0 height=100 width=100 name=D alt="Middle-Left"></a></td>
                                <td><a href="javascript:play('E')"><img src="blank.jpg" border=0 height=100 width=100 name=E alt="Middle-Center"></a></td>
                                <td><a href="javascript:play('F')"><img src="blank.jpg" border=0 height=100 width=100 name=F alt="Middle-Right"></a></td>
                            </tr>
                            <tr>
                                <td><a href="javascript:play('G')"><img src="blank.jpg" border=0 height=100 width=100 name=G alt="Bottom-Left"></a></td>
                                <td><a href="javascript:play('H')"><img src="blank.jpg" border=0 height=100 width=100 name=H alt="Bottom-Center"></a></td>
                                <td><a href="javascript:play('I')"><img src="blank.jpg" border=0 height=100 width=100  name=I alt="Bottom-Right"></a></td>
                            </tr>
                        </table>
                    </td>
                    <td>
                        <table>
                            <tr><td><input type=text size=5 name=P1></td><td id="player1">Player 1</td></tr>
                            <tr><td><input type=text size=5 name=P2></td><td id="player2">Player 2</td></tr>
                        </table>
                    </td>
                </table>
                <input type=button value="Play Again" onClick="askPlayer();">
                    &nbsp;&nbsp;
                    <input type=button value="Game Help" onClick="help();">
                        &nbsp;&nbsp;
                        <!-- <input type=button value="Quit Game" onClick="quitGame();"> -->
                        </form>
        </center></div>
	</div>
    <div id="linkbar">
        <a href="index.html">Home</a>&nbsp;&nbsp;&nbsp;
        <a href="login.html">Login</a>&nbsp;&nbsp;&nbsp;
        <a href="tictactwo.html">Hot Seat Multiplayer</a>&nbsp;&nbsp;&nbsp;
        <a href="hostgame.html">Host Online Game</a>&nbsp;&nbsp;&nbsp;
        <a href="records.html">Check Records</a>&nbsp;&nbsp;&nbsp;
        <a href="aboutus.html">About Us</a>&nbsp;&nbsp;&nbsp;
</div>
	<div id="copyright">
		&copy; 2013 Apathy Studios
	</div>
</body>
</html>